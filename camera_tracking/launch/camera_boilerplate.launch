<launch>
  <arg name="load_manager" default="true"/>
  <arg name="manager_name" default="camera_manager"/>
  <arg name="manager_threads" default="4"/>
  <arg name="camera_name" default="cam0"/>

  <node if="$(arg load_manager)" pkg="nodelet" type="nodelet" name="$(arg manager_name)" args="manager" output="screen">
    <param name="num_worker_threads" value="$(arg manager_threads)"/>
  </node>

  <!-- De-Bayer / rectify -->
  <include file="$(find image_proc)/launch/image_proc.launch">
    <arg name="manager" value="$(arg manager_name)"/>
  </include>

  <!-- Apriltag detection -->
  <node pkg="apriltag_ros" type="apriltag_ros_continuous_node" name="apriltag" output="screen">
    <param name="camera_frame" type="str" value="$(arg camera_name)"/>
    <param name="publish_tag_detections_image" type="bool" value="true"/>
    <rosparam command="load" file="$(find camera_tracking)/config/apriltag_settings.yaml"/>
    <rosparam command="load" file="$(find camera_tracking)/config/tags.yaml"/>
  </node>

  <!-- Localization -->
  <node pkg="camera_tracking" type="localizer" name="localizer" output="screen">
    <param name="origin_id" type="str" value="0"/>
    <param name="buffer_size" type="int" value="300"/>
    <param name="ball_sub_topic" type="str" value="ball_vec"/>
    <param name="ball_pub_topic" type="str" value="/ball/pose"/>
    <param name="ball_radius" type="double" value="0.05"/>
    <rosparam param="pub_topics">
      '0': /origin/pose
      '2': /car0/pose
    </rosparam>
  </node>

  <!-- Ball tracking -->
  <node pkg="camera_tracking" type="ball_detection" name="ball_detection">
    <param name="publishThresh" value="false"/>
    <param name="min_hue" value="60"/>
    <param name="min_sat" value="135"/>
    <param name="min_vib" value="50"/>
    <param name="max_hue" value="140"/>
    <param name="max_sat" value="255"/>
    <param name="max_vib" value="255"/>
  </node>
</launch>
