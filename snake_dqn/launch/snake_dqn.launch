<launch>
  <arg name="training"  default="false"/>
  <arg name="render"    default="false"/>

  <arg name="size"  default="7"/>
  <arg name="vw"    default="3.0"/>
  <arg name="vx"    default="3.0"/>
  <arg name="rate"  default="10.0"/>

  <arg name="max_time"      default="30.0"/>
  <arg name="num_episodes"  default="5000"/>

  <arg name="death_reward"  default="0.0"/>
  <arg name="goal_reward"   default="50.0"/>
  <arg name="base_reward"   default="0.0"/>
  <arg name="exp_reward"    default="0.0"/>

  <arg name="memory_len"    default="30000"/>
  <arg name="gamma"         default="0.95"/>
  <arg name="epsilon_decay" default="0.995"/>
  <arg name="epsilon_min"   default="0.05"/>
  <arg name="learning_rate" default="0.01"/>
  <arg name="batch_size"    default="64"/>

  <arg name="log_weights"       default="false"/>
  <arg name="log_progress"      default="false"/>
  <arg name="log_dir"           default=""/>
  <arg name="log_freq"          default="250"/>
  <arg name="plot_buffer_size"  default="25"/>

  <param name="/use_sim_time" value="$(arg training)"/>

  <node type="snake_node" pkg="snakesim" name="snake_node" output="screen">
    <param name="render/enabled"          value="$(arg render)"/>
    <param name="snake/initial_segments"  value="$(arg size)"/>
    <param name="snake/growth"            value="0"/>
    <param name="rate"                    value="$(arg rate)"/>
  </node>

  <node type="snake_dqn" pkg="snake_dqn" name="snake_dqn" output="screen" respawn="true" args="$(eval '--training' if training else '')">
    <param name="num_segments"     value="$(arg size)"/>
    <param name="angular_velocity" value="$(arg vw)"/>
    <param name="linear_velocity"  value="$(arg vx)"/>
    <param name="rate"             value="$(arg rate)"/>

    <param name="max_episode_time"      value="$(arg max_time)"/>
    <param name="num_episodes"      value="$(arg num_episodes)"/>

    <param name="reward/death"          value="$(arg death_reward)"/>
    <param name="reward/goal"           value="$(arg goal_reward)"/>
    <param name="reward/distance/base"  value="$(arg base_reward)"/>
    <param name="reward/distance/exp"   value="$(arg exp_reward)"/>

    <param name="dqn/memory_len"    value="$(arg memory_len)"/>
    <param name="dqn/gamma"         value="$(arg gamma)"/>
    <param name="dqn/epsilon_decay" value="$(arg epsilon_decay)"/>
    <param name="dqn/epsilon_min"   value="$(arg epsilon_min)"/>
    <param name="dqn/learning_rate" value="$(arg learning_rate)"/>
    <param name="dqn/batch_size"    value="$(arg batch_size)"/>
  </node>

  <node if="$(arg log_weights)" type="logger" pkg="snake_dqn" name="logger" output="screen">
    <param name="log_dir"     value="$(arg log_dir)"/>
    <param name="log_freq"    value="$(arg log_freq)"/>
  </node>

  <node if="$(arg log_progress)" type="plotter" pkg="snake_dqn" name="plotter" output="screen">
    <param name="log_dir"     value="$(arg log_dir)"/>
    <param name="log_freq"    value="$(arg log_freq)"/>
    <param name="buffer_size" value="$(arg plot_buffer_size)"/>
  </node>
</launch>
